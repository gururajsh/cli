name: Test release version

on:
  workflow_dispatch:
    inputs:
      release_version:
        description: 'Release version bump'
        required: true
        default: 'patch'
        type: choice
        options:
          - minor
          - patch

jobs:
  calculate-new-version:
    runs-on: ubuntu-latest
    env:
      MAJOR_VERSOIN: 8
      GH_TOKEN: ${{ github.token }}
    steps:
      - name: Checkout cli
        uses: actions/checkout@v4

      - name: Print the input tag to STDOUT
        run: echo  The tags are ${{ inputs.release_version }} 

      - name: Get latest tag
        run: |
          set -ex
          latest_tag="$(gh release list -L 2 --exclude-pre-releases --exclude-drafts --json tagName --jq '.[].tagName' | grep v${MAJOR_VERSION})"
          echo "Latest tag is ${latest_tag}"

          VERSION="${latest_tag#[vV]}"

          VERSION_MINOR="${VERSION#*.}"
          echo "1.minor version is ${VERSION_MINOR}"
          VERSION_MINOR="${VERSION_MINOR%.*}"
          echo "2.minor version is ${VERSION_MINOR}"

      - name: Setup tmate session
        if: always()
        uses: mxschmitt/action-tmate@v3
